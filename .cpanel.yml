---
deployment:
  tasks:
    - export DEPLOYPATH=/home/cyonexla/public_html/

    # Step 0: Activate Node.js virtual environment
    - source /home/cyonexla/nodevenv/repositories/cyonex/24/bin/activate

    # Step 1: Install dependencies
    - npm ci

    # Step 2: Build the React app
    - npm run build

    # Step 3: Remove old build
    - /bin/rm -rf $DEPLOYPATH/*

    # Step 4: Copy new build to public_html
    - /bin/cp -R build/* $DEPLOYPATH

    # Step 5: Add .htaccess for React Router support
    - /bin/echo "<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
RewriteRule ^index\.html$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.html [L]
</IfModule>" > $DEPLOYPATH/.htaccess
